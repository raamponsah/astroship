---
import PaystackPop from '@paystack/inline-js';
import { supabase } from '../../../lib/supabase';

const {entry} = Astro.props;
const price = Math.floor(entry?.data?.actualPrice - (entry?.data?.actualPrice * (entry?.data?.discount || 0)) / 100);
const { data, error } = await supabase.auth.getSession();

async function handleSubmit(event) {
  event.preventDefault();
  const { data, error } = await supabase.auth.getSession();
  if (error) {
    console.error('Error fetching session:', error.message);
    return;
  }
  // payWithPaystack(data);
}

---

<div class="border border-purple-400 bg-gradient-to-r from-pink-200 to-purple-300 rounded p-8">
  <h2 class="text-xl lg:text-2xl rounded font-semibold mb-4">Payment Details</h2>
  <form id="paymentForm" class="mx-auto">
    <div class="mb-6">
      <label for="email" class="block text-gray-700 font-bold mb-2">Email Address</label>
      <input
        type="email"
        id="email"
        class="w-full border rounded-md px-4 py-2 focus:outline-none focus:border-indigo-500"
        placeholder="Enter your email"
        value={data ? data?.session?.user?.email : ""}
        required
        disabled={data && data?.session?.user?.email}
      />
    </div>
    
    <div class="mb-6">
      <label for="amount" class="block text-gray-700 font-bold mb-2">Amount</label>
      <input
        type="tel"
        disabled
        value={`GHS ${price}`}
        id="amount"
        class="w-full border rounded-md px-4 py-2 focus:outline-none focus:border-indigo-500"
        placeholder="Enter the amount"
      />
    </div>


{
  data?.session?.user ?(<div></div>): (
  <div class="mb-6">
      <label for="first-name" class="block text-gray-700 font-bold mb-2">First Name</label>
      <input
        type="text"
        id="first-name"
        class="w-full border rounded-md px-4 py-2 focus:outline-none focus:border-indigo-500"
        placeholder="Enter your first name"
       
     
      />
    </div>
    <div class="mb-6">
      <label for="last-name" class="block text-gray-700 font-bold mb-2">Last Name</label>
      <input
        type="text"
        id="last-name"
        class="w-full border rounded-md px-4 py-2 focus:outline-none focus:border-indigo-500"
        placeholder="Enter your last name"
       
        
      />
    </div>
    <div class="mb-6">
      <label for="phoneNumber" class="block text-gray-700 font-bold mb-2">Phone number</label>
      <input
        type="tel"
        id="phoneNumber"
        class="w-full border rounded-md px-4 py-2 focus:outline-none focus:border-indigo-500"
        placeholder="Enter your phone number"
    

      />
    </div>
  )
}
 
    <div class="flex justify-center">
      <button type="submit" class="border border-purple-400 bg-gradient-to-r from-pink-600 to-purple-800 w-full hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-md focus:outline-none focus:shadow-outline">Pay</button>
    </div>
    <small class="text-purple-800 text-xs">Payment will be processed with Paystack</small>
  </form>
</div>
